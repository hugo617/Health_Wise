<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>用户详情 - <%= @user.nickname %> - 烯晞数字健康档案系统</title>
    <!-- Bootstrap CSS -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        :root {
            --primary-blue: #667eea;
            --secondary-purple: #764ba2;
            --accent-teal: #06b6d4;
            --accent-emerald: #10b981;
            --accent-rose: #f43f5e;
            --glass-bg: rgba(255, 255, 255, 0.1);
            --glass-border: rgba(255, 255, 255, 0.18);
        }
        
        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 50%, #f093fb 100%);
            font-family: 'Inter', -apple-system, BlinkMacSystemFont, sans-serif;
            color: #333;
            padding: 20px;
            min-height: 100vh;
        }
        
        .content-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 25px;
            background: var(--glass-bg);
            backdrop-filter: blur(10px);
            border: 1px solid var(--glass-border);
            border-radius: 1rem;
            padding: 1.5rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
        }
        
        .content-header h1 {
            font-size: 1.75rem;
            color: white;
            margin: 0;
            font-weight: 600;
        }
        
        .card {
            background: rgba(255, 255, 255, 0.95);
            border: none;
            border-radius: 1rem;
            box-shadow: 0 8px 32px rgba(0, 0, 0, 0.1);
            margin-bottom: 1.5rem;
            backdrop-filter: blur(10px);
        }
        
        .card-header {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-purple));
            color: white;
            border-bottom: none;
            border-radius: 1rem 1rem 0 0 !important;
            font-weight: 600;
            padding: 1.25rem 1.5rem;
        }
        
        .btn-primary {
            background: linear-gradient(135deg, var(--primary-blue), var(--secondary-purple));
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);
        }
        
        .btn-secondary {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            border: none;
            border-radius: 0.5rem;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-secondary:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 12px rgba(156, 163, 175, 0.4);
        }
        
        .badge {
            font-size: 0.85rem;
            font-weight: 600;
            padding: 0.5rem 1rem;
            border-radius: 0.5rem;
        }
        
        .role-admin {
            background: linear-gradient(135deg, #f093fb, #f5576c);
            color: white;
        }
        
        .role-user {
            background: linear-gradient(135deg, #4facfe, #00f2fe);
            color: white;
        }
        
        .status-active {
            background: linear-gradient(135deg, var(--accent-emerald), #059669);
            color: white;
        }
        
        .status-inactive {
            background: linear-gradient(135deg, #9ca3af, #6b7280);
            color: white;
        }
        
        .status-banned {
            background: linear-gradient(135deg, var(--accent-rose), #dc2626);
            color: white;
        }
        
        .info-item {
            padding: 1rem 0;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .info-item:last-child {
            border-bottom: none;
        }
        
        .info-label {
            font-weight: 600;
            color: #6b7280;
            margin-bottom: 0.5rem;
        }
        
        .info-value {
            font-size: 1.1rem;
            color: #111827;
        }
        
        .avatar-container {
            text-align: center;
            padding: 2rem;
        }
        
        .user-avatar {
            width: 120px;
            height: 120px;
            border-radius: 50%;
            object-fit: cover;
            border: 4px solid white;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
        
        .toast-container {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1050;
        }
        
        .toast {
            border-radius: 0.75rem;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.15);
        }
    </style>
</head>
<body>
    <!-- Toast 通知 -->
    <div class="toast-container">
        <div class="toast" id="notificationToast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <strong class="me-auto" id="toastTitle">通知</strong>
                <button type="button" class="btn-close" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
            <div class="toast-body" id="toastMessage">
                操作成功完成！
            </div>
        </div>
    </div>

    <!-- 页面标题和操作按钮 -->
    <div class="content-header">
        <h1><i class="fas fa-user-circle me-3"></i>用户详情</h1>
        <div>
            <%= link_to edit_user_path(@user), class: "btn btn-primary me-2" do %>
                <i class="fas fa-edit me-2"></i>编辑用户
            <% end %>
            <%= link_to users_path, class: "btn btn-secondary" do %>
                <i class="fas fa-arrow-left me-2"></i>返回列表
            <% end %>
        </div>
    </div>

    <div class="row">
        <!-- 用户基本信息 -->
        <div class="col-md-4">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-user me-2"></i>基本信息
                </div>
                <div class="card-body">
                    <div class="avatar-container">
                        <% if @user.avatar_path.present? %>
                            <%= image_tag @user.avatar_path, class: "user-avatar", alt: "用户头像" %>
                        <% else %>
                            <div class="user-avatar bg-gradient-primary d-flex align-items-center justify-content-center">
                                <i class="fas fa-user fa-3x text-white"></i>
                            </div>
                        <% end %>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">用户ID</div>
                        <div class="info-value">#<%= @user.id %></div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">昵称</div>
                        <div class="info-value"><%= @user.nickname %></div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">手机号</div>
                        <div class="info-value"><%= @user.phone_number %></div>
                    </div>
                    
                    <div class="info-item">
                        <div class="info-label">邮箱</div>
                        <div class="info-value"><%= @user.email %></div>
                    </div>
                </div>
            </div>
        </div>
        
        <!-- 用户详细信息 -->
        <div class="col-md-8">
            <div class="card">
                <div class="card-header">
                    <i class="fas fa-info-circle me-2"></i>详细信息
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6">
                            <div class="info-item">
                                <div class="info-label">角色</div>
                                <div class="info-value">
                                    <span class="badge <%= @user.role == 'admin' ? 'role-admin' : 'role-user' %>">
                                        <%= @user.role == 'admin' ? '管理员' : '普通用户' %>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="info-item">
                                <div class="info-label">状态</div>
                                <div class="info-value">
                                    <span class="badge status-<%= @user.status %>">
                                        <%= get_status_text(@user.status) %>
                                    </span>
                                </div>
                            </div>
                            
                            <div class="info-item">
                                <div class="info-label">会员类型</div>
                                <div class="info-value">
                                    <span class="badge bg-secondary"><%= @user.membership_type %></span>
                                </div>
                            </div>
                        </div>
                        
                        <div class="col-md-6">
                            <div class="info-item">
                                <div class="info-label">创建时间</div>
                                <div class="info-value"><%= @user.created_at.strftime('%Y-%m-%d %H:%M:%S') %></div>
                            </div>
                            
                            <div class="info-item">
                                <div class="info-label">最后更新</div>
                                <div class="info-value"><%= @user.updated_at.strftime('%Y-%m-%d %H:%M:%S') %></div>
                            </div>
                            
                            <% if @user.deleted_at.present? %>
                                <div class="info-item">
                                    <div class="info-label">删除时间</div>
                                    <div class="info-value text-danger">
                                        <%= @user.deleted_at.strftime('%Y-%m-%d %H:%M:%S') %>
                                    </div>
                                </div>
                            <% end %>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- 健康报告信息 -->
            <% if @user.health_reports.any? %>
                <div class="card">
                    <div class="card-header">
                        <i class="fas fa-file-medical me-2"></i>健康报告
                    </div>
                    <div class="card-body">
                        <p class="text-muted mb-3">该用户共有 <%= @user.health_reports.count %> 份健康报告</p>
                        
                        <div class="row">
                            <% @user.health_reports.limit(6).each do |report| %>
                                <div class="col-md-6 mb-3">
                                    <div class="border rounded p-3">
                                        <div class="d-flex justify-content-between align-items-center">
                                            <div>
                                                <h6 class="mb-1">
                                                    <%= report.report_type == '基因检查报告' ? 
                                                        '<i class="fas fa-dna text-primary me-2"></i>基因检查报告' :
                                                        '<i class="fas fa-microscope text-success me-2"></i>蛋白质检测报告' %>
                                                </h6>
                                                <small class="text-muted">
                                                    <%= report.created_at.strftime('%Y-%m-%d %H:%M') %>
                                                </small>
                                            </div>
                                            <%= link_to health_report_path(report), class: "btn btn-sm btn-outline-primary" do %>
                                                <i class="fas fa-eye me-1"></i>查看
                                            <% end %>
                                        </div>
                                    </div>
                                </div>
                            <% end %>
                        </div>
                        
                        <% if @user.health_reports.count > 6 %>
                            <div class="text-center mt-3">
                                <%= link_to health_reports_path(user_id: @user.id), class: "btn btn-outline-primary" do %>
                                    <i class="fas fa-list me-2"></i>查看所有报告
                                <% end %>
                            </div>
                        <% end %>
                    </div>
                </div>
            <% end %>
        </div>
    </div>

    <!-- Bootstrap JS Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // 显示通知消息
        function showNotification(title, message, type = 'success') {
            const toast = document.getElementById('notificationToast');
            const toastTitle = document.getElementById('toastTitle');
            const toastMessage = document.getElementById('toastMessage');
            
            toastTitle.textContent = title;
            toastMessage.textContent = message;
            
            // 设置通知类型样式
            toast.className = 'toast';
            if (type === 'success') {
                toast.classList.add('bg-success', 'text-white');
            } else if (type === 'error') {
                toast.classList.add('bg-danger', 'text-white');
            } else if (type === 'warning') {
                toast.classList.add('bg-warning');
            } else if (type === 'info') {
                toast.classList.add('bg-info', 'text-white');
            }
            
            const bsToast = new bootstrap.Toast(toast, { delay: 3000 });
            bsToast.show();
        }

        // 页面加载完成后的处理
        document.addEventListener('DOMContentLoaded', function() {
            // 检查是否有通知消息
            <% if flash[:notice] %>
                showNotification('成功', '<%= j flash[:notice] %>', 'success');
            <% end %>
            
            <% if flash[:alert] %>
                showNotification('错误', '<%= j flash[:alert] %>', 'error');
            <% end %>
        });
    </script>
</body>
</html>

<%
# 辅助方法：获取状态文本
def get_status_text(status)
  case status
  when 'active'
    '正常'
  when 'inactive'
    '禁用'
  when 'banned'
    '封禁'
  else
    status
  end
end
%>